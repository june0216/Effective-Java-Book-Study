### 11ì¥ : ë™ì‹œì„±
# ğŸ€ [ì•„ì´í…œ 83] ì§€ì—° ì´ˆê¸°í™”ëŠ” ì‹ ì¤‘íˆ ì‚¬ìš©í•˜ë¼
 
## ğŸ“’ ì§€ì—° ì´ˆê¸°í™” lazy initialization
- í•„ë“œì˜ ì´ˆê¸°í™” ì‹œì ì„ ê·¸ ê°’ì´ ì²˜ìŒ í•„ìš”í•  ë•Œê¹Œì§€ ëŠ¦ì¶”ëŠ” ê¸°ë²•
- ê°’ì´ ì“°ì´ì§€ ì•Šìœ¼ë©´ ì´ˆê¸°í™”ë„ ì ˆëŒ€ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤
- í´ë˜ìŠ¤ì™€ ì¸ìŠ¤í„´ìŠ¤ ì´ˆê¸°í™” ë•Œ ë°œìƒí•˜ëŠ” ìœ„í—˜í•œ ìˆœí™˜ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤

### ìµœì í™”ì—ì„œì˜ ì§€ì—° ì´ˆê¸°í™”
- í´ë˜ìŠ¤ í˜¹ì€ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì‹œì˜ ì´ˆê¸°í™” ë¹„ìš©ì€ ê°ì†Œí•œë‹¤
- í•˜ì§€ë§Œ ì§€ì—° ì´ˆê¸°í™”ë˜ëŠ” í•„ë“œì— ì ‘ê·¼í•˜ëŠ” ë¹„ìš©ì€ ì»¤ì§„ë‹¤
=> ì§€ì—° ì´ˆê¸°í™” í•„ë“œ ì¤‘ ê²°êµ­ ì´ˆê¸°í™”ê°€ ì´ë¤„ì§€ëŠ” ë¹„ìœ¨, ì‹¤ì œ ì´ˆê¸°í™”ì— ë“œëŠ” ë¹„ìš©, ì´ˆê¸°í™”ëœ ê° í•„ë“œì˜ í˜¸ì¶œ ë¹ˆë„ì— ë”°ë¼ ì„±ëŠ¥ íŒë‹¨

### ì§€ì—° ì´ˆê¸°í™”ê°€ í•„ìš”í•œ ì‹œì 
- í•´ë‹¹ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ ì¤‘ ê·¸ í•„ë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ì˜ ë¹„ìœ¨ì´ ë‚®ê³ , ê·¸ í•„ë“œë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ë¹„ìš©ì´ í´ ë•Œ
=> ì§€ì—° ì´ˆê¸°í™” ì ìš© ì „í›„ì˜ ì„±ëŠ¥ì„ ì¸¡ì •

### ë©€í‹° ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œì˜ ì§€ì—° ì´ˆê¸°í™”
ì§€ì—° ì´ˆê¸°í™” í•„ë“œë¥¼ ë‘˜ ì´ìƒì˜ ìŠ¤ë ˆë“œê°€ ê³µìœ í•œë‹¤ë©´ ë°˜ë“œì‹œ ë™ê¸°í™”!

## ğŸ“’ ì´ˆê¸°í™” ë°©ë²•
```java
public class FieldType {
}

public class Initialization {
  private static FieldType computeFieldValue() {
    return new FieldType();
  }
}
```

### ğŸ“ƒ ì¸ìŠ¤í„´ìŠ¤ í•„ë“œì˜ ì¼ë°˜ì ì¸ ì´ˆê¸°í™”
> ëŒ€ë¶€ë¶„ì˜ ìƒí™©ì—ì„œ ì¼ë°˜ì ì¸ ì´ˆê¸°í™”ê°€ ì§€ì—° ì´ˆê¸°í™”ë³´ë‹¤ ë‚«ë‹¤
```java
private final FieldType field1 = computeFieldValue();
```

### ğŸ“ƒ ì¸ìŠ¤í„´ìŠ¤ í•„ë“œì˜ ì§€ì—° ì´ˆê¸°í™”
> ì§€ì—° ì´ˆê¸°í™”ê°€ ì´ˆê¸°í™” ìˆœí™˜ì„±ì„ ê¹¨ëœ¨ë¦´ ê²ƒ ê°™ìœ¼ë©´ synchronizedë¥¼ ë‹¨ ì ‘ê·¼ì ì‚¬ìš©

**ì´ˆê¸°í™” ìˆœí™˜ì„±[ initialization circularity ]**
Class A in its constructor creates instance of class B, class B creates instance of class C, and class C creates instance of class A.

```java
private FieldType field2;
private synchronized FieldType getField2() {
  if (field2 == null)
    field2 = computeFieldValue();
  return field2;
}
```

### ğŸ“ƒ ì •ì  í•„ë“œìš© [ì§€ì—° ì´ˆê¸°í™” í™€ë” í´ë˜ìŠ¤] ê´€ìš©êµ¬
> ì„±ëŠ¥ ë•Œë¬¸ì— ì •ì  í•„ë“œë¥¼ ì§€ì—° ì´ˆê¸°í™”í•˜ëŠ” ê²½ìš°
- í´ë˜ìŠ¤ê°€ ì²˜ìŒ ì“°ì¼ ë•Œ ë¹„ë¡œì†Œ ì´ˆê¸°í™”
- getField ë©”ì„œë“œê°€ í•„ë“œì— ì ‘ê·¼í•˜ë©´ì„œ ë™ê¸°í™”ë¥¼ ì „í˜€ í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì„±ëŠ¥ì´ ëŠë ¤ì§€ì§€ ì•ŠìŒ

```java
private static class FieldHolder {
  static final FieldType field = computeFieldValue();
}

private static FieldType getField() { return FieldHolder.field; }
```

- ì¼ë°˜ì ì¸ VMì€ í´ë˜ìŠ¤ë¥¼ ì´ˆê¸°í™”í•  ë•Œë§Œ í•„ë“œ ì ‘ê·¼ì„ ë™ê¸°í™”
- í´ë˜ìŠ¤ ì´ˆê¸°í™”ê°€ ëë‚œ í›„ì—ëŠ” VMì´ ë™ê¸°í™” ì½”ë“œë¥¼ ì œê±°í•˜ì—¬, ê·¸ ë‹¤ìŒë¶€í„°ëŠ” ì•„ë¬´ëŸ° ê²€ì‚¬ë‚˜ ë™ê¸°í™”ì—†ì´ í•„ë“œì— ì ‘ê·¼

### ğŸ“ƒ ì¸ìŠ¤í„´ìŠ¤ í•„ë“œ ì§€ì—° ì´ˆê¸°í™”ìš© [ì´ì¤‘ê²€ì‚¬] ê´€ìš©êµ¬
> ì„±ëŠ¥ ë•Œë¬¸ì— ì¸ìŠ¤í„´ìŠ¤ í•„ë“œë¥¼ ì§€ì—° ì´ˆê¸°í™”í•˜ëŠ” ê²½ìš°

- ì´ˆê¸°í™”ëœ í•„ë“œì— ì ‘ê·¼í•  ë•Œì˜ ë™ê¸°í™” ë¹„ìš©ì„ ì—†ì• ì¤€ë‹¤
- ì²« ë²ˆì§¸ ê²€ì‚¬ : ë™ê¸°í™” ì—†ì´ ê²€ì‚¬
- ë‘ ë²ˆì§¸ ê²€ì‚¬ : ë™ê¸°í™”í•˜ì—¬ ê²€ì‚¬ (í•„ë“œê°€ ì•„ì§ ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ ìˆ˜í–‰)
-> ë‘ ë²ˆì§¸ ê²€ì‚¬ì—ì„œë„ í•„ë“œê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ë‹¤ë©´ ê·¸ì œì„œì•¼ ì´ˆê¸°í™”

- í•„ë“œê°€ ì´ˆê¸°í™”ëœ ì´í›„ë¡œëŠ” ë™ê¸°í™”í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë°˜ë“œì‹œ volatileìœ¼ë¡œ ì„ ì–¸

```java
private volatile FieldType field4;

private FieldType getField4() {
  FieldType result = field4;
  if (result != null)    // ì²« ë²ˆì§¸ ê²€ì‚¬ (ë½ ì‚¬ìš© ì•ˆ í•¨)
    return result;

  synchronized(this) {
    if (field4 == null) // ë‘ ë²ˆì§¸ ê²€ì‚¬ (ë½ ì‚¬ìš©)
      field4 = computeFieldValue();
    return field4;
  }
}
```

### ğŸ“ƒ [ë‹¨ì¼ê²€ì‚¬] ê´€ìš©êµ¬
ë°˜ë³µí•´ì„œ ì´ˆê¸°í™”í•´ë„ ìƒê´€ì—†ëŠ” ì¸ìŠ¤í„´ìŠ¤ í•„ë“œë¥¼ ì§€ì—° ì´ˆê¸°í™”í•˜ëŠ” ê²½ìš°ì— ì‚¬ìš©

```java
private volatile FieldType field5;

private FieldType getField5() {
  FieldType result = field5;
  if (result == null)
    field5 = result = computeFieldValue();
  return result;
}

private static FieldType computeFieldValue() {
  return new FieldType();
}
```

### ğŸ“ƒ [ì§œë¦¿í•œ ë‹¨ì¼ê²€ì‚¬] ê´€ìš©êµ¬
- ëª¨ë“  ìŠ¤ë ˆë“œê°€ í•„ë“œì˜ ê°’ì„ ë‹¤ì‹œ ê³„ì‚°í•´ë„ ìƒê´€ì—†ê³ , í•„ë“œì˜ íƒ€ì…ì´ longê³¼ doubleì„ ì œì™¸í•œ ë‹¤ë¥¸ ê¸°ë³¸ íƒ€ì…ì¸ ê²½ìš°
- ë‹¨ì¼ ê²€ì‚¬ì˜ í•„ë“œ ì„ ì–¸ì—ì„œ volatileì„ ì—†ì•´ë‹¤
```java
private FieldType field5;

private FieldType getField5() {
  FieldType result = field5;
  if (result == null)
    field5 = result = computeFieldValue();
  return result;
}

private static FieldType computeFieldValue() {
  return new FieldType();
}
```